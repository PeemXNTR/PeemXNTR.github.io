# คู่มือระบบติดตามยานพาหนะด้วย GPS

## สารบัญ
1. [ภาพรวมระบบ](#ภาพรวมระบบ)
2. [องค์ประกอบของระบบ](#องค์ประกอบของระบบ)
3. [การติดตั้งระบบ](#การติดตั้งระบบ)
4. [การใช้งานแดชบอร์ด](#การใช้งานแดชบอร์ด)
5. [หน้าจอของระบบ](#หน้าจอของระบบ)
6. [ฐานข้อมูลที่ใช้ในระบบ](#ฐานข้อมูลที่ใช้ในระบบ)
7. [การแก้ไขปัญหาเบื้องต้น](#การแก้ไขปัญหาเบื้องต้น)
8. [การพัฒนาเพิ่มเติม](#การพัฒนาเพิ่มเติม)

## ภาพรวมระบบ

ระบบติดตามยานพาหนะด้วย GPS นี้ถูกพัฒนาขึ้นเพื่อติดตามตำแหน่งของยานพาหนะแบบเรียลไทม์ โดยใช้เทคโนโลยี LoRa (Long Range) สำหรับการสื่อสารไร้สายระยะไกลร่วมกับ MQTT (Message Queuing Telemetry Transport) สำหรับการรับส่งข้อมูลระหว่างอุปกรณ์และเซิร์ฟเวอร์

ระบบประกอบด้วย 3 ส่วนหลัก:
1. **อุปกรณ์ GPS Tracker** (ติดตั้งบนยานพาหนะ): รับข้อมูลตำแหน่งจาก GPS และส่งข้อมูลผ่าน LoRa
2. **Gateway** (LoRa ถึง MQTT): รับข้อมูลจาก LoRa และส่งต่อไปยัง MQTT Broker
3. **แดชบอร์ด**: แสดงข้อมูลตำแหน่งและสถานะของยานพาหนะแบบเรียลไทม์

## องค์ประกอบของระบบ

### 1. ฮาร์ดแวร์
- **GPS Tracker (Transmitter)**:
  - NodeMCU ESP8266
  - GPS Module (GY-GPS6MV2)
  - LoRa Module (SX1278)
  - จอ LCD I2C 16x2
  
- **LoRa MQTT Gateway**:
  - NodeMCU ESP8266
  - LoRa Module (SX1278)
  - จอ LCD I2C 16x2

### 2. ซอฟต์แวร์
- **Firmware สำหรับ GPS Tracker**: Arduino sketch (`GPS_Tracker_Transmitter.ino`)
- **Firmware สำหรับ Gateway**: Arduino sketch (`LoRa_MQTT_Gateway.ino`)
- **Backend Server**: Node.js + Express + MongoDB (`server.js`)
- **Frontend Web Dashboard**: React.js (`Dashboard.js` และอื่นๆ)

### 3. บริการคลาวด์
- **MQTT Broker**: NETPIE (broker.netpie.io)
- **Map Service**: Longdo Map API

## การติดตั้งระบบ

### การติดตั้งฮาร์ดแวร์

#### GPS Tracker (Transmitter)
การเชื่อมต่อ GY-GPS6MV2 กับ NodeMCU V3:
```
GY-GPS6MV2  |  NodeMCU V3
--------------------------------
VCC         |  3.3V
GND         |  GND
TX          |  D2 (GPIO4)
RX          |  D3 (GPIO0)
```

การเชื่อมต่อ SX1278 LoRa กับ NodeMCU V3:
```
SX1278 LoRa |  NodeMCU V3
--------------------------------
VCC         |  3.3V
GND         |  GND
MISO        |  D6 (GPIO12)
MOSI        |  D7 (GPIO13)
SCK         |  D5 (GPIO14)
NSS         |  D8 (GPIO15)
RST         |  D4 (GPIO2)
DIO0        |  D1 (GPIO5)
```

การเชื่อมต่อ LCD I2C:
```
LCD I2C     |  NodeMCU V3
--------------------------------
VCC         |  3.3V
GND         |  GND
SDA         |  D10 (GPIO1/TX)
SCL         |  RX (GPIO3)
```

#### LoRa MQTT Gateway
การเชื่อมต่อ SX1278 LoRa กับ NodeMCU V3:
```
SX1278 LoRa |  NodeMCU V3
--------------------------------
VCC         |  3.3V
GND         |  GND
MISO        |  D6 (GPIO12)
MOSI        |  D7 (GPIO13)
SCK         |  D5 (GPIO14)
NSS         |  D8 (GPIO15)
RST         |  D4 (GPIO2)
DIO0        |  D1 (GPIO5)
```

การเชื่อมต่อ LCD I2C:
```
LCD I2C     |  NodeMCU V3
--------------------------------
VCC         |  3.3V
GND         |  GND
SDA         |  D3 (GPIO0)
SCL         |  D9 (GPIO3/RX)
```

### การติดตั้งซอฟต์แวร์

#### Backend Server
1. ติดตั้ง Node.js และ npm
2. ติดตั้ง MongoDB
3. นำเข้าโค้ดจากโฟลเดอร์ `backend`
4. เปิดเทอร์มินัลที่โฟลเดอร์หลักของโปรเจค และรันคำสั่ง:
```
cd backend
npm install
node server.js
```

#### Frontend Web Dashboard
1. เปิดเทอร์มินัลที่โฟลเดอร์หลักของโปรเจค และรันคำสั่ง:
```
npm install
npm start
```

#### การอัปโหลด Firmware ไปยังอุปกรณ์
1. ติดตั้ง Arduino IDE
2. ติดตั้งไลบรารีที่จำเป็น:
   - LoRa
   - TinyGPS++
   - SoftwareSerial
   - ArduinoJson
   - ESP8266WiFi
   - Wire
   - LiquidCrystal_I2C
   - PubSubClient (สำหรับ Gateway)
3. เลือกบอร์ด "NodeMCU 1.0 (ESP-12E Module)" ใน Arduino IDE
4. อัปโหลด `GPS_Tracker_Transmitter.ino` ไปยัง GPS Tracker
5. อัปโหลด `LoRa_MQTT_Gateway.ino` ไปยัง Gateway

## หน้าจอของระบบ

ระบบติดตามยานพาหนะมีหน้าจอหลัก 2 หน้า ได้แก่ หน้าแดชบอร์ดหลักและหน้าประวัติการเดินทาง

### 1. หน้าแดชบอร์ดหลัก (Dashboard)

หน้าแดชบอร์ดหลักแบ่งออกเป็นส่วนต่างๆ ดังนี้:

#### ส่วนบน (Header)
- **โลโก้และชื่อระบบ**: ด้านซ้ายบนของหน้าจอ
- **สถานะการเชื่อมต่อ**: แสดงสถานะการเชื่อมต่อกับ MQTT โดยแสดงเป็นไฟสีเขียว (เชื่อมต่อแล้ว) หรือสีแดง (ไม่ได้เชื่อมต่อ)
- **เวลาปัจจุบัน**: แสดงเวลาปัจจุบันของระบบ

#### ส่วนแผนที่ (Map Section)
- **แผนที่แสดงตำแหน่ง**: แสดงแผนที่ Longdo Map พร้อมกับตำแหน่งปัจจุบันของยานพาหนะแสดงเป็นจุดสีน้ำเงิน
- **เส้นทางการเดินทาง**: แสดงเส้นทางที่ยานพาหนะเคลื่อนที่โดยใช้เส้นสีน้ำเงิน
- **สถานที่สำคัญ**: แสดงสถานที่สำคัญใกล้เคียงเป็นจุดสีเขียวพร้อมไอคอนตามประเภทของสถานที่

#### ส่วนข้อมูลตำแหน่ง (Location Info)
- **ละติจูด/ลองจิจูด**: แสดงค่าพิกัดปัจจุบันในรูปแบบทศนิยม
- **อัปเดตล่าสุด**: แสดงเวลาล่าสุดที่ได้รับข้อมูลตำแหน่ง
- **ความเร็ว**: แสดงความเร็วปัจจุบันในหน่วย กม./ชม.
- **ระยะทาง**: แสดงระยะทางทั้งหมดที่เดินทางมาแล้ว

#### ส่วนข้อมูลรถ (Vehicle Info)
- **สถานะเชื้อเพลิง**: แสดงระดับเชื้อเพลิงปัจจุบันในรูปแบบกราฟแท่งแนวนอนสีเขียวถึงแดง
- **อัตราการใช้เชื้อเพลิง**: แสดงอัตราการใช้เชื้อเพลิงในหน่วย ลิตร/100 กม.
- **ความเร็วสูงสุด**: แสดงความเร็วสูงสุดที่ทำได้ในการเดินทางปัจจุบัน
- **อุณหภูมิเครื่องยนต์**: แสดงอุณหภูมิเครื่องยนต์ในรูปแบบเกจวัดแบบกลม

#### ส่วนสถานที่ใกล้เคียง (Nearby POIs)
- **รายการสถานที่**: แสดงรายชื่อสถานที่สำคัญใกล้เคียงเรียงตามระยะทาง
- **ประเภทสถานที่**: แสดงประเภทของสถานที่พร้อมไอคอน
- **ระยะห่าง**: แสดงระยะห่างจากตำแหน่งปัจจุบันถึงสถานที่นั้นๆ

#### ส่วนควบคุม (Control Panel)
- **ปุ่มเรียกรถ**: ปุ่มขนาดใหญ่สีเขียวมีข้อความ "เรียกรถ" สำหรับส่งคำสั่งเรียกรถไปยังอุปกรณ์
- **ปุ่มควบคุมไฟ**: ปุ่มสลับเปิด/ปิดสำหรับควบคุมไฟบนยานพาหนะ
- **ปุ่มรีเฟรช**: ปุ่มสำหรับรีเฟรชข้อมูลแบบทันที

### 2. หน้าประวัติการเดินทาง (History)

หน้าประวัติการเดินทางแบ่งออกเป็นส่วนต่างๆ ดังนี้:

#### ส่วนตัวกรอง (Filter)
- **ช่วงวันที่**: ปฏิทินสำหรับเลือกช่วงวันที่ต้องการดูประวัติ
- **ประเภทการเดินทาง**: ตัวเลือกสำหรับกรองประเภทการเดินทาง (ทั้งหมด, ธุรกิจ, ส่วนตัว)
- **ปุ่มค้นหา**: ปุ่มสำหรับเริ่มการค้นหาตามเงื่อนไขที่กำหนด

#### ส่วนตารางประวัติ (History Table)
- **ตารางข้อมูล**: แสดงข้อมูลประวัติการเดินทางในรูปแบบตาราง
  - **คอลัมน์วันที่/เวลา**: แสดงวันที่และเวลาของการเดินทาง
  - **คอลัมน์ต้นทาง**: แสดงสถานที่ต้นทางหรือพิกัดเริ่มต้น
  - **คอลัมน์ปลายทาง**: แสดงสถานที่ปลายทางหรือพิกัดสิ้นสุด
  - **คอลัมน์ระยะทาง**: แสดงระยะทางทั้งหมดของการเดินทาง
  - **คอลัมน์ระยะเวลา**: แสดงระยะเวลาที่ใช้ในการเดินทาง
  - **คอลัมน์ความเร็วเฉลี่ย**: แสดงความเร็วเฉลี่ยของการเดินทาง
  - **คอลัมน์การใช้เชื้อเพลิง**: แสดงปริมาณเชื้อเพลิงที่ใช้
  - **คอลัมน์การดำเนินการ**: ปุ่มสำหรับดูรายละเอียด, แก้ไข หรือลบข้อมูล

#### ส่วนแผนที่ย้อนหลัง (History Map)
- **แผนที่**: แสดงแผนที่พร้อมเส้นทางของการเดินทางที่เลือกจากตาราง
- **จุดแวะพัก**: แสดงจุดที่ยานพาหนะจอดนานเกิน 5 นาทีเป็นจุดสีแดง
- **จุดเริ่มต้นและสิ้นสุด**: แสดงจุดเริ่มต้นและสิ้นสุดของการเดินทางด้วยไอคอนพิเศษ

#### ส่วนกราฟข้อมูล (Data Graphs)
- **กราฟความเร็ว**: แสดงความเร็วของยานพาหนะตลอดการเดินทาง
- **กราฟการใช้เชื้อเพลิง**: แสดงอัตราการใช้เชื้อเพลิงตลอดการเดินทาง
- **กราฟระดับแบตเตอรี่**: แสดงระดับแบตเตอรี่ของอุปกรณ์ GPS ตลอดการเดินทาง

#### ส่วนสรุปข้อมูล (Summary)
- **คะแนนการขับขี่**: แสดงคะแนนการขับขี่จาก 1-10 พร้อมคำอธิบาย
- **การใช้เชื้อเพลิงโดยรวม**: แสดงสรุปการใช้เชื้อเพลิงเทียบกับค่าเฉลี่ย
- **เวลาที่ประหยัด**: แสดงเวลาที่ประหยัดได้เทียบกับการเดินทางโดยเฉลี่ย

### หน้าอุปกรณ์ (Device Interfaces)

#### จอ LCD บน GPS Tracker
จอ LCD ขนาด 16x2 ตัวอักษรบน GPS Tracker แสดงข้อมูลดังนี้:
- **บรรทัดที่ 1**: แสดงสถานะ GPS (จำนวนดาวเทียมที่เชื่อมต่อ) และสถานะ LoRa
- **บรรทัดที่ 2**: หมุนเวียนแสดงข้อมูล:
  - พิกัด (LAT/LON)
  - ความเร็ว (SPD)
  - เวลาที่ทำงาน (UPT)
  - สถานะการส่งข้อมูล (TX)

#### จอ LCD บน LoRa Gateway
จอ LCD ขนาด 16x2 ตัวอักษรบน LoRa Gateway แสดงข้อมูลดังนี้:
- **บรรทัดที่ 1**: แสดงสถานะการเชื่อมต่อ WiFi และ MQTT
- **บรรทัดที่ 2**: หมุนเวียนแสดงข้อมูล:
  - จำนวนข้อมูลที่รับได้ (RX)
  - จำนวนข้อมูลที่ส่งไปยัง MQTT (TX)
  - IP Address ของอุปกรณ์
  - เวลาที่ทำงาน (UPT)

## ฐานข้อมูลที่ใช้ในระบบ

ระบบนี้ใช้ MongoDB เป็นฐานข้อมูลหลัก โดยมีโครงสร้างคอลเลกชันดังนี้:

### 1. คอลเลกชัน Location
เก็บข้อมูลตำแหน่งและประวัติของยานพาหนะ

| ฟิลด์ | ประเภทข้อมูล | คำอธิบาย |
|------|------------|----------|
| location | Object | ข้อมูลตำแหน่ง GeoJSON |
| location.type | String | ประเภทข้อมูล GeoJSON (Point) |
| location.coordinates | Array | พิกัด [longitude, latitude] |
| timestamp | Date | เวลาที่บันทึกข้อมูล |
| additionalInfo | Map | ข้อมูลเพิ่มเติม (ความเร็ว, ระดับเชื้อเพลิง, ฯลฯ) |

ตัวอย่างข้อมูล:
```json
{
  "_id": "ObjectId(...)",
  "location": {
    "type": "Point",
    "coordinates": [100.5678, 13.7890]
  },
  "timestamp": "2023-03-12T12:34:56.789Z",
  "additionalInfo": {
    "speed": 45,
    "altitude": 120,
    "satellites": 8,
    "fuel": 75
  }
}
```

### 2. คอลเลกชัน POI
เก็บข้อมูลสถานที่สำคัญ (Points of Interest)

| ฟิลด์ | ประเภทข้อมูล | คำอธิบาย |
|------|------------|----------|
| name | String | ชื่อสถานที่ |
| description | String | รายละเอียดสถานที่ |
| location | Object | ข้อมูลตำแหน่ง GeoJSON |
| location.type | String | ประเภทข้อมูล GeoJSON (Point) |
| location.coordinates | Array | พิกัด [longitude, latitude] |
| category | String | ประเภทสถานที่ (building, landmark, restaurant, office, parking, other) |
| details | Map | ข้อมูลเพิ่มเติมของสถานที่ |
| createdAt | Date | วันที่สร้างข้อมูล |

ตัวอย่างข้อมูล:
```json
{
  "_id": "ObjectId(...)",
  "name": "ศูนย์การค้าเซ็นทรัล",
  "description": "ศูนย์การค้าขนาดใหญ่",
  "location": {
    "type": "Point",
    "coordinates": [100.5390, 13.7500]
  },
  "category": "building",
  "details": {
    "openingHours": "10:00-22:00",
    "contact": "02-123-4567",
    "website": "https://www.central.co.th"
  },
  "createdAt": "2023-03-10T09:00:00.000Z"
}
```

## การแก้ไขปัญหาเบื้องต้น

### ปัญหาการเชื่อมต่อ MQTT
1. ตรวจสอบการเชื่อมต่ออินเทอร์เน็ตของ Gateway
2. ตรวจสอบข้อมูลการเชื่อมต่อ MQTT (client ID, username, password)
3. ตรวจสอบสถานะ MQTT Broker ที่ NETPIE Dashboard

### ปัญหาการรับสัญญาณ GPS
1. ตรวจสอบการเชื่อมต่อระหว่าง GPS Module และ NodeMCU
2. นำอุปกรณ์ไปไว้ในที่โล่งเพื่อรับสัญญาณดาวเทียมได้ดีขึ้น
3. รอให้ GPS ค้นหาดาวเทียมประมาณ 5-10 นาที (cold start)

### ปัญหาการสื่อสาร LoRa
1. ตรวจสอบการเชื่อมต่อระหว่าง LoRa Module และ NodeMCU
2. ตรวจสอบว่า Tracker และ Gateway ใช้ความถี่เดียวกัน (433MHz)
3. ลดระยะห่างระหว่าง Tracker และ Gateway

### ปัญหาแดชบอร์ดไม่แสดงข้อมูล
1. ตรวจสอบว่า Backend Server กำลังทำงานอยู่
2. ตรวจสอบการเชื่อมต่อกับ MongoDB
3. ตรวจสอบ API Endpoints ใน Network Tab ของ Developer Tools

### การรีเซ็ตระบบ
1. **GPS Tracker**: กด Reset บน NodeMCU
2. **Gateway**: กด Reset บน NodeMCU
3. **Backend**: รีสตาร์ท Node.js server (`Ctrl+C` แล้ว `node server.js`)
4. **Frontend**: รีสตาร์ท React development server (`Ctrl+C` แล้ว `npm start`)

## การพัฒนาเพิ่มเติม

### การเพิ่มอุปกรณ์ GPS Tracker
1. สร้างอุปกรณ์ใหม่ตามแบบ GPS Tracker เดิม
2. ปรับแก้ firmware เพื่อกำหนด ID ให้ไม่ซ้ำกับอุปกรณ์เดิม
3. อัปโหลด firmware ไปยังอุปกรณ์ใหม่
4. ทดสอบการส่งข้อมูลไปยัง Gateway

### การปรับแต่งแดชบอร์ด
1. แก้ไขไฟล์ `src/Dashboard.js` เพื่อเพิ่มหรือแก้ไขฟีเจอร์
2. แก้ไขไฟล์ `src/Dashboard.css` เพื่อปรับแต่งรูปแบบการแสดงผล
3. เพิ่ม Component ใหม่ใน `src` ตามต้องการ

### การเพิ่มฟีเจอร์ใหม่
1. **การแจ้งเตือน**: เพิ่มระบบแจ้งเตือนเมื่อยานพาหนะออกนอกพื้นที่กำหนด
2. **การวิเคราะห์การขับขี่**: เพิ่มการวิเคราะห์พฤติกรรมการขับขี่จากข้อมูลความเร็วและตำแหน่ง
3. **การรายงานสรุป**: สร้างรายงานสรุปการใช้งานยานพาหนะประจำวัน/สัปดาห์/เดือน 
## การใช้งานแดชบอร์ด

แดชบอร์ดเว็บแอปพลิเคชันมีฟีเจอร์ดังนี้:

### หน้าหลัก
- **แผนที่แสดงตำแหน่ง**: แสดงตำแหน่งปัจจุบันของยานพาหนะบนแผนที่แบบเรียลไทม์
- **สถานะการเชื่อมต่อ**: แสดงสถานะการเชื่อมต่อกับ MQTT
- **ข้อมูลตำแหน่ง**: แสดงละติจูด, ลองจิจูด และเวลาอัปเดตล่าสุด
- **ประวัติการเดินทาง**: แสดงประวัติตำแหน่งที่ยานพาหนะเคยอยู่
- **ข้อมูลความเร็ว**: แสดงความเร็วปัจจุบันและความเร็วสูงสุด
- **ข้อมูลเชื้อเพลิง**: แสดงระดับเชื้อเพลิงปัจจุบัน, ความจุสูงสุด และอัตราการใช้เชื้อเพลิง
- **สถานที่ใกล้เคียง**: แสดงสถานที่สำคัญที่อยู่ใกล้ตำแหน่งปัจจุบัน
- **ส่งคำสั่งควบคุม**: ปุ่มสำหรับเรียกรถและเปิด/ปิดไฟ

### การใช้งาน
1. เข้าสู่หน้าเว็บแอปพลิเคชันที่ http://localhost:3000
2. เลือกแท็บ "แผนที่" เพื่อดูตำแหน่งปัจจุบัน
3. เลือกแท็บ "ประวัติ" เพื่อดูประวัติการเดินทาง
4. คลิกที่สถานที่ในรายการ "สถานที่ใกล้เคียง" เพื่อดูรายละเอียด
5. ใช้ปุ่ม "เรียกรถ" เพื่อส่งคำสั่งเรียกรถไปยังอุปกรณ์

### การตั้งค่าเริ่มต้น
- ระบบจะเชื่อมต่อกับ MQTT โดยอัตโนมัติเมื่อเปิดใช้งาน
- การอัปเดตข้อมูลบนแผนที่จะเกิดขึ้นทันทีเมื่อได้รับข้อมูลใหม่
- ประวัติตำแหน่งจะถูกเก็บในฐานข้อมูลและแสดงในรูปแบบตาราง

## หน้าจอของระบบ

ระบบติดตามยานพาหนะมีหน้าจอหลัก 2 หน้า ได้แก่ หน้าแดชบอร์ดหลักและหน้าประวัติการเดินทาง

### 1. หน้าแดชบอร์ดหลัก (Dashboard)

หน้าแดชบอร์ดหลักแบ่งออกเป็นส่วนต่างๆ ดังนี้:

#### ส่วนบน (Header)
- **โลโก้และชื่อระบบ**: ด้านซ้ายบนของหน้าจอ
- **สถานะการเชื่อมต่อ**: แสดงสถานะการเชื่อมต่อกับ MQTT โดยแสดงเป็นไฟสีเขียว (เชื่อมต่อแล้ว) หรือสีแดง (ไม่ได้เชื่อมต่อ)
- **เวลาปัจจุบัน**: แสดงเวลาปัจจุบันของระบบ

#### ส่วนแผนที่ (Map Section)
- **แผนที่แสดงตำแหน่ง**: แสดงแผนที่ Longdo Map พร้อมกับตำแหน่งปัจจุบันของยานพาหนะแสดงเป็นจุดสีน้ำเงิน
- **เส้นทางการเดินทาง**: แสดงเส้นทางที่ยานพาหนะเคลื่อนที่โดยใช้เส้นสีน้ำเงิน
- **สถานที่สำคัญ**: แสดงสถานที่สำคัญใกล้เคียงเป็นจุดสีเขียวพร้อมไอคอนตามประเภทของสถานที่

#### ส่วนข้อมูลตำแหน่ง (Location Info)
- **ละติจูด/ลองจิจูด**: แสดงค่าพิกัดปัจจุบันในรูปแบบทศนิยม
- **อัปเดตล่าสุด**: แสดงเวลาล่าสุดที่ได้รับข้อมูลตำแหน่ง
- **ความเร็ว**: แสดงความเร็วปัจจุบันในหน่วย กม./ชม.
- **ระยะทาง**: แสดงระยะทางทั้งหมดที่เดินทางมาแล้ว

#### ส่วนข้อมูลรถ (Vehicle Info)
- **สถานะเชื้อเพลิง**: แสดงระดับเชื้อเพลิงปัจจุบันในรูปแบบกราฟแท่งแนวนอนสีเขียวถึงแดง
- **อัตราการใช้เชื้อเพลิง**: แสดงอัตราการใช้เชื้อเพลิงในหน่วย ลิตร/100 กม.
- **ความเร็วสูงสุด**: แสดงความเร็วสูงสุดที่ทำได้ในการเดินทางปัจจุบัน
- **อุณหภูมิเครื่องยนต์**: แสดงอุณหภูมิเครื่องยนต์ในรูปแบบเกจวัดแบบกลม

#### ส่วนสถานที่ใกล้เคียง (Nearby POIs)
- **รายการสถานที่**: แสดงรายชื่อสถานที่สำคัญใกล้เคียงเรียงตามระยะทาง
- **ประเภทสถานที่**: แสดงประเภทของสถานที่พร้อมไอคอน
- **ระยะห่าง**: แสดงระยะห่างจากตำแหน่งปัจจุบันถึงสถานที่นั้นๆ

#### ส่วนควบคุม (Control Panel)
- **ปุ่มเรียกรถ**: ปุ่มขนาดใหญ่สีเขียวมีข้อความ "เรียกรถ" สำหรับส่งคำสั่งเรียกรถไปยังอุปกรณ์
- **ปุ่มควบคุมไฟ**: ปุ่มสลับเปิด/ปิดสำหรับควบคุมไฟบนยานพาหนะ
- **ปุ่มรีเฟรช**: ปุ่มสำหรับรีเฟรชข้อมูลแบบทันที

### 2. หน้าประวัติการเดินทาง (History)

หน้าประวัติการเดินทางแบ่งออกเป็นส่วนต่างๆ ดังนี้:

#### ส่วนตัวกรอง (Filter)
- **ช่วงวันที่**: ปฏิทินสำหรับเลือกช่วงวันที่ต้องการดูประวัติ
- **ประเภทการเดินทาง**: ตัวเลือกสำหรับกรองประเภทการเดินทาง (ทั้งหมด, ธุรกิจ, ส่วนตัว)
- **ปุ่มค้นหา**: ปุ่มสำหรับเริ่มการค้นหาตามเงื่อนไขที่กำหนด

#### ส่วนตารางประวัติ (History Table)
- **ตารางข้อมูล**: แสดงข้อมูลประวัติการเดินทางในรูปแบบตาราง
  - **คอลัมน์วันที่/เวลา**: แสดงวันที่และเวลาของการเดินทาง
  - **คอลัมน์ต้นทาง**: แสดงสถานที่ต้นทางหรือพิกัดเริ่มต้น
  - **คอลัมน์ปลายทาง**: แสดงสถานที่ปลายทางหรือพิกัดสิ้นสุด
  - **คอลัมน์ระยะทาง**: แสดงระยะทางทั้งหมดของการเดินทาง
  - **คอลัมน์ระยะเวลา**: แสดงระยะเวลาที่ใช้ในการเดินทาง
  - **คอลัมน์ความเร็วเฉลี่ย**: แสดงความเร็วเฉลี่ยของการเดินทาง
  - **คอลัมน์การใช้เชื้อเพลิง**: แสดงปริมาณเชื้อเพลิงที่ใช้
  - **คอลัมน์การดำเนินการ**: ปุ่มสำหรับดูรายละเอียด, แก้ไข หรือลบข้อมูล

#### ส่วนแผนที่ย้อนหลัง (History Map)
- **แผนที่**: แสดงแผนที่พร้อมเส้นทางของการเดินทางที่เลือกจากตาราง
- **จุดแวะพัก**: แสดงจุดที่ยานพาหนะจอดนานเกิน 5 นาทีเป็นจุดสีแดง
- **จุดเริ่มต้นและสิ้นสุด**: แสดงจุดเริ่มต้นและสิ้นสุดของการเดินทางด้วยไอคอนพิเศษ

#### ส่วนกราฟข้อมูล (Data Graphs)
- **กราฟความเร็ว**: แสดงความเร็วของยานพาหนะตลอดการเดินทาง
- **กราฟการใช้เชื้อเพลิง**: แสดงอัตราการใช้เชื้อเพลิงตลอดการเดินทาง
- **กราฟระดับแบตเตอรี่**: แสดงระดับแบตเตอรี่ของอุปกรณ์ GPS ตลอดการเดินทาง

#### ส่วนสรุปข้อมูล (Summary)
- **คะแนนการขับขี่**: แสดงคะแนนการขับขี่จาก 1-10 พร้อมคำอธิบาย
- **การใช้เชื้อเพลิงโดยรวม**: แสดงสรุปการใช้เชื้อเพลิงเทียบกับค่าเฉลี่ย
- **เวลาที่ประหยัด**: แสดงเวลาที่ประหยัดได้เทียบกับการเดินทางโดยเฉลี่ย

### หน้าอุปกรณ์ (Device Interfaces)

#### จอ LCD บน GPS Tracker
จอ LCD ขนาด 16x2 ตัวอักษรบน GPS Tracker แสดงข้อมูลดังนี้:
- **บรรทัดที่ 1**: แสดงสถานะ GPS (จำนวนดาวเทียมที่เชื่อมต่อ) และสถานะ LoRa
- **บรรทัดที่ 2**: หมุนเวียนแสดงข้อมูล:
  - พิกัด (LAT/LON)
  - ความเร็ว (SPD)
  - เวลาที่ทำงาน (UPT)
  - สถานะการส่งข้อมูล (TX)

#### จอ LCD บน LoRa Gateway
จอ LCD ขนาด 16x2 ตัวอักษรบน LoRa Gateway แสดงข้อมูลดังนี้:
- **บรรทัดที่ 1**: แสดงสถานะการเชื่อมต่อ WiFi และ MQTT
- **บรรทัดที่ 2**: หมุนเวียนแสดงข้อมูล:
  - จำนวนข้อมูลที่รับได้ (RX)
  - จำนวนข้อมูลที่ส่งไปยัง MQTT (TX)
  - IP Address ของอุปกรณ์
  - เวลาที่ทำงาน (UPT)

## ฐานข้อมูลที่ใช้ในระบบ

ระบบนี้ใช้ MongoDB เป็นฐานข้อมูลหลัก โดยมีโครงสร้างคอลเลกชันดังนี้:

### 1. คอลเลกชัน Location
เก็บข้อมูลตำแหน่งและประวัติของยานพาหนะ

| ฟิลด์ | ประเภทข้อมูล | คำอธิบาย |
|------|------------|----------|
| location | Object | ข้อมูลตำแหน่ง GeoJSON |
| location.type | String | ประเภทข้อมูล GeoJSON (Point) |
| location.coordinates | Array | พิกัด [longitude, latitude] |
| timestamp | Date | เวลาที่บันทึกข้อมูล |
| additionalInfo | Map | ข้อมูลเพิ่มเติม (ความเร็ว, ระดับเชื้อเพลิง, ฯลฯ) |

ตัวอย่างข้อมูล:
```json
{
  "_id": "ObjectId(...)",
  "location": {
    "type": "Point",
    "coordinates": [100.5678, 13.7890]
  },
  "timestamp": "2023-03-12T12:34:56.789Z",
  "additionalInfo": {
    "speed": 45,
    "altitude": 120,
    "satellites": 8,
    "fuel": 75
  }
}
```

### 2. คอลเลกชัน POI
เก็บข้อมูลสถานที่สำคัญ (Points of Interest)

| ฟิลด์ | ประเภทข้อมูล | คำอธิบาย |
|------|------------|----------|
| name | String | ชื่อสถานที่ |
| description | String | รายละเอียดสถานที่ |
| location | Object | ข้อมูลตำแหน่ง GeoJSON |
| location.type | String | ประเภทข้อมูล GeoJSON (Point) |
| location.coordinates | Array | พิกัด [longitude, latitude] |
| category | String | ประเภทสถานที่ (building, landmark, restaurant, office, parking, other) |
| details | Map | ข้อมูลเพิ่มเติมของสถานที่ |
| createdAt | Date | วันที่สร้างข้อมูล |

ตัวอย่างข้อมูล:
```json
{
  "_id": "ObjectId(...)",
  "name": "ศูนย์การค้าเซ็นทรัล",
  "description": "ศูนย์การค้าขนาดใหญ่",
  "location": {
    "type": "Point",
    "coordinates": [100.5390, 13.7500]
  },
  "category": "building",
  "details": {
    "openingHours": "10:00-22:00",
    "contact": "02-123-4567",
    "website": "https://www.central.co.th"
  },
  "createdAt": "2023-03-10T09:00:00.000Z"
}
```

## การแก้ไขปัญหาเบื้องต้น

### ปัญหาการเชื่อมต่อ MQTT
1. ตรวจสอบการเชื่อมต่ออินเทอร์เน็ตของ Gateway
2. ตรวจสอบข้อมูลการเชื่อมต่อ MQTT (client ID, username, password)
3. ตรวจสอบสถานะ MQTT Broker ที่ NETPIE Dashboard

### ปัญหาการรับสัญญาณ GPS
1. ตรวจสอบการเชื่อมต่อระหว่าง GPS Module และ NodeMCU
2. นำอุปกรณ์ไปไว้ในที่โล่งเพื่อรับสัญญาณดาวเทียมได้ดีขึ้น
3. รอให้ GPS ค้นหาดาวเทียมประมาณ 5-10 นาที (cold start)

### ปัญหาการสื่อสาร LoRa
1. ตรวจสอบการเชื่อมต่อระหว่าง LoRa Module และ NodeMCU
2. ตรวจสอบว่า Tracker และ Gateway ใช้ความถี่เดียวกัน (433MHz)
3. ลดระยะห่างระหว่าง Tracker และ Gateway

### ปัญหาแดชบอร์ดไม่แสดงข้อมูล
1. ตรวจสอบว่า Backend Server กำลังทำงานอยู่
2. ตรวจสอบการเชื่อมต่อกับ MongoDB
3. ตรวจสอบ API Endpoints ใน Network Tab ของ Developer Tools

### การรีเซ็ตระบบ
1. **GPS Tracker**: กด Reset บน NodeMCU
2. **Gateway**: กด Reset บน NodeMCU
3. **Backend**: รีสตาร์ท Node.js server (`Ctrl+C` แล้ว `node server.js`)
4. **Frontend**: รีสตาร์ท React development server (`Ctrl+C` แล้ว `npm start`)

## การพัฒนาเพิ่มเติม

### การเพิ่มอุปกรณ์ GPS Tracker
1. สร้างอุปกรณ์ใหม่ตามแบบ GPS Tracker เดิม
2. ปรับแก้ firmware เพื่อกำหนด ID ให้ไม่ซ้ำกับอุปกรณ์เดิม
3. อัปโหลด firmware ไปยังอุปกรณ์ใหม่
4. ทดสอบการส่งข้อมูลไปยัง Gateway

### การปรับแต่งแดชบอร์ด
1. แก้ไขไฟล์ `src/Dashboard.js` เพื่อเพิ่มหรือแก้ไขฟีเจอร์
2. แก้ไขไฟล์ `src/Dashboard.css` เพื่อปรับแต่งรูปแบบการแสดงผล
3. เพิ่ม Component ใหม่ใน `src` ตามต้องการ

### การเพิ่มฟีเจอร์ใหม่
1. **การแจ้งเตือน**: เพิ่มระบบแจ้งเตือนเมื่อยานพาหนะออกนอกพื้นที่กำหนด
2. **การวิเคราะห์การขับขี่**: เพิ่มการวิเคราะห์พฤติกรรมการขับขี่จากข้อมูลความเร็วและตำแหน่ง
3. **การรายงานสรุป**: สร้างรายงานสรุปการใช้งานยานพาหนะประจำวัน/สัปดาห์/เดือน 
