{% extends 'base.html' %}

{% block title %}ตั้งค่าระบบ{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">ตั้งค่าระบบ</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- ตั้งค่าฟาร์ม -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">ข้อมูลฟาร์ม</h2>
            <form action="{{ url_for('save_farm_settings') }}" method="post" class="space-y-4">
                <div>
                    <label for="farm_name" class="block text-sm font-medium text-gray-700 mb-1">ชื่อฟาร์ม</label>
                    <input type="text" name="farm_name" id="farm_name" value="{{ farm_settings.farm_name }}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="farm_address" class="block text-sm font-medium text-gray-700 mb-1">ที่อยู่</label>
                    <textarea name="farm_address" id="farm_address" rows="3" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">{{ farm_settings.farm_address }}</textarea>
                </div>
                <div>
                    <label for="farm_phone" class="block text-sm font-medium text-gray-700 mb-1">เบอร์โทรศัพท์</label>
                    <input type="text" name="farm_phone" id="farm_phone" value="{{ farm_settings.farm_phone }}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="farm_email" class="block text-sm font-medium text-gray-700 mb-1">อีเมล</label>
                    <input type="email" name="farm_email" id="farm_email" value="{{ farm_settings.farm_email }}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm">บันทึกข้อมูลฟาร์ม</button>
                </div>
            </form>
        </div>
        
        <!-- ตั้งค่าระบบ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">การตั้งค่าระบบ</h2>
            <form action="{{ url_for('save_system_settings') }}" method="post" class="space-y-4">
                <div>
                    <label for="notification_enabled" class="block text-sm font-medium text-gray-700 mb-1">การแจ้งเตือน</label>
                    <div class="flex items-center">
                        <input type="checkbox" name="notification_enabled" id="notification_enabled" {% if system_settings.notification_enabled %}checked{% endif %} class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <span class="ml-2">เปิดใช้งานการแจ้งเตือน</span>
                    </div>
                </div>
                <div>
                    <label for="auto_backup" class="block text-sm font-medium text-gray-700 mb-1">การสำรองข้อมูลอัตโนมัติ</label>
                    <div class="flex items-center">
                        <input type="checkbox" name="auto_backup" id="auto_backup" {% if system_settings.auto_backup %}checked{% endif %} class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <span class="ml-2">เปิดใช้งานการสำรองข้อมูลอัตโนมัติ</span>
                    </div>
                </div>
                <div>
                    <label for="backup_frequency" class="block text-sm font-medium text-gray-700 mb-1">ความถี่ในการสำรองข้อมูล</label>
                    <select name="backup_frequency" id="backup_frequency" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <option value="daily" {% if system_settings.backup_frequency == 'daily' %}selected{% endif %}>รายวัน</option>
                        <option value="weekly" {% if system_settings.backup_frequency == 'weekly' %}selected{% endif %}>รายสัปดาห์</option>
                        <option value="monthly" {% if system_settings.backup_frequency == 'monthly' %}selected{% endif %}>รายเดือน</option>
                    </select>
                </div>
                <div>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm">บันทึกการตั้งค่าระบบ</button>
                </div>
            </form>
        </div>
        
        <!-- การสำรองและกู้คืนข้อมูล -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">การสำรองและกู้คืนข้อมูล</h2>
            <div class="space-y-4">
                <div>
                    <form action="{{ url_for('backup_data') }}" method="post">
                        <input type="hidden" name="backup_type" value="csv">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm w-full">สำรองข้อมูลเป็นไฟล์ CSV</button>
                    </form>
                </div>
                <div>
                    <form action="{{ url_for('backup_data') }}" method="post">
                        <input type="hidden" name="backup_type" value="sql">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm w-full">สำรองฐานข้อมูล (SQL)</button>
                    </form>
                </div>
                <div class="mt-8">
                    <h3 class="text-lg font-medium mb-2">นำเข้าข้อมูล</h3>
                    <form action="{{ url_for('import_data') }}" method="post" enctype="multipart/form-data" class="space-y-4">
                        <div>
                            <label for="import_file" class="block text-sm font-medium text-gray-700 mb-1">เลือกไฟล์ CSV</label>
                            <input type="file" name="import_file" id="import_file" class="w-full border rounded-md p-2">
                        </div>
                        <div>
                            <label for="import_type" class="block text-sm font-medium text-gray-700 mb-1">ประเภทข้อมูล</label>
                            <select name="import_type" id="import_type" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                                <option value="chickens">ข้อมูลไก่</option>
                                <option value="feedings">ข้อมูลการให้อาหาร</option>
                                <option value="egg_collections">ข้อมูลการเก็บไข่</option>
                                <option value="barns">ข้อมูลโรงเรือน</option>
                                <option value="customers">ข้อมูลลูกค้า</option>
                            </select>
                        </div>
                        <div>
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm">นำเข้าข้อมูล</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- จัดการผู้ใช้ (สำหรับ Admin เท่านั้น) -->
        {% if current_user.role == 'admin' %}
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">จัดการผู้ใช้</h2>
            <a href="{{ url_for('users') }}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm mb-4">จัดการผู้ใช้ทั้งหมด</a>
            
            <h3 class="text-lg font-medium mt-6 mb-3">เพิ่มผู้ใช้ใหม่</h3>
            <form action="{{ url_for('add_user') }}" method="post" class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">ชื่อผู้ใช้</label>
                    <input type="text" name="username" id="username" required class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="full_name" class="block text-sm font-medium text-gray-700 mb-1">ชื่อ-นามสกุล</label>
                    <input type="text" name="full_name" id="full_name" required class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">อีเมล</label>
                    <input type="email" name="email" id="email" required class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">รหัสผ่าน</label>
                    <input type="password" name="password" id="password" required class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                </div>
                <div>
                    <label for="role" class="block text-sm font-medium text-gray-700 mb-1">บทบาท</label>
                    <select name="role" id="role" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
                        <option value="user">ผู้ใช้ทั่วไป</option>
                        <option value="manager">ผู้จัดการ</option>
                        <option value="admin">ผู้ดูแลระบบ</option>
                    </select>
                </div>
                <div>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm">เพิ่มผู้ใช้</button>
                </div>
            </form>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}