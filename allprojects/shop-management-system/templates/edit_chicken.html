{% extends 'base.html' %}

{% block title %}แก้ไขข้อมูลไก่ - ระบบจัดการฟาร์มไก่{% endblock %}

{% block content %}
<div class="mb-6 flex items-center justify-between">
    <div>
        <h1 class="text-2xl font-bold text-gray-800">แก้ไขข้อมูลไก่</h1>
        <p class="text-gray-600 mt-1">แก้ไขข้อมูลไก่ ID: {{ chicken.id }}</p>
    </div>
    <div class="flex items-center gap-3">
        <a href="{{ url_for('chickens') }}" class="text-sm text-gray-600 hover:text-primary flex items-center">
            <i data-feather="arrow-left" class="h-4 w-4 mr-1"></i>
            <span>กลับไปหน้าจัดการไก่</span>
        </a>
        <form method="POST" action="{{ url_for('delete_chicken', chicken_id=chicken.id) }}" id="delete-form" onsubmit="return confirmDelete()">
            <button type="submit" class="text-sm text-red-600 hover:text-red-800 flex items-center">
                <i data-feather="trash-2" class="h-4 w-4 mr-1"></i>
                <span>ลบข้อมูลไก่</span>
            </button>
        </form>
    </div>
</div>

<div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100">
    <form method="POST" action="{{ url_for('edit_chicken', chicken_id=chicken.id) }}" class="space-y-6">
        <div class="grid sm:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">ชื่อไก่ <span class="text-red-500">*</span></label>
                    <input type="text" id="name" name="name" required value="{{ chicken.name }}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                        placeholder="ระบุชื่อไก่">
                </div>
                
                <div>
                    <label for="breed" class="block text-sm font-medium text-gray-700 mb-1">สายพันธุ์ <span class="text-red-500">*</span></label>
                    <select id="breed" name="breed" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors appearance-none bg-white">
                        <option value="" disabled>-- เลือกสายพันธุ์ --</option>
                        <option value="ไก่ไข่" {% if chicken.breed == 'ไก่ไข่' %}selected{% endif %}>ไก่ไข่</option>
                        <option value="ไก่เนื้อ" {% if chicken.breed == 'ไก่เนื้อ' %}selected{% endif %}>ไก่เนื้อ</option>
                        <option value="ไก่พื้นเมือง" {% if chicken.breed == 'ไก่พื้นเมือง' %}selected{% endif %}>ไก่พื้นเมือง</option>
                        <option value="ไก่ชน" {% if chicken.breed == 'ไก่ชน' %}selected{% endif %}>ไก่ชน</option>
                        <option value="ไก่แจ้" {% if chicken.breed == 'ไก่แจ้' %}selected{% endif %}>ไก่แจ้</option>
                        <option value="ไก่งวง" {% if chicken.breed == 'ไก่งวง' %}selected{% endif %}>ไก่งวง</option>
                        <option value="อื่นๆ" {% if chicken.breed == 'อื่นๆ' %}selected{% endif %}>อื่นๆ</option>
                    </select>
                </div>
                
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700 mb-1">อายุ (เดือน) <span class="text-red-500">*</span></label>
                    <input type="number" id="age" name="age" min="0" step="1" required value="{{ chicken.age }}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                        placeholder="ระบุอายุเป็นเดือน">
                </div>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label for="weight" class="block text-sm font-medium text-gray-700 mb-1">น้ำหนัก (กก.) <span class="text-red-500">*</span></label>
                    <input type="number" id="weight" name="weight" min="0" step="0.1" required value="{{ chicken.weight }}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                        placeholder="ระบุน้ำหนักเป็นกิโลกรัม">
                </div>
                
                <div>
                    <label for="health_status" class="block text-sm font-medium text-gray-700 mb-1">สถานะสุขภาพ <span class="text-red-500">*</span></label>
                    <select id="health_status" name="health_status" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors appearance-none bg-white">
                        <option value="" disabled>-- เลือกสถานะสุขภาพ --</option>
                        <option value="ดี" {% if chicken.health_status == 'ดี' %}selected{% endif %}>ดี</option>
                        <option value="ปานกลาง" {% if chicken.health_status == 'ปานกลาง' %}selected{% endif %}>ปานกลาง</option>
                        <option value="แย่" {% if chicken.health_status == 'แย่' %}selected{% endif %}>แย่</option>
                    </select>
                </div>
                
                <div>
                    <label for="egg_production_rate" class="block text-sm font-medium text-gray-700 mb-1">อัตราการออกไข่ (%) <span class="text-red-500">*</span></label>
                    <input type="number" id="egg_production_rate" name="egg_production_rate" min="0" max="100" required value="{{ chicken.egg_production_rate }}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                        placeholder="ระบุอัตราการออกไข่เป็นเปอร์เซ็นต์">
                </div>
            </div>
        </div>
        
        <div>
            <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">หมายเหตุ</label>
            <textarea id="notes" name="notes" rows="3"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                placeholder="บันทึกรายละเอียดเพิ่มเติม (ถ้ามี)">{{ chicken.notes }}</textarea>
        </div>
        
        <div class="pt-4 flex flex-col sm:flex-row sm:justify-between gap-3">
            <div class="text-sm text-gray-600">
                <span class="text-red-500">*</span> ข้อมูลที่จำเป็นต้องกรอก
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
                <a href="{{ url_for('chickens') }}" 
                    class="w-full sm:w-auto px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors text-center">
                    ยกเลิก
                </a>
                <button type="submit" 
                    class="w-full sm:w-auto px-6 py-2 bg-primary hover:bg-accent text-white rounded-lg transition-colors flex items-center justify-center">
                    <i data-feather="save" class="h-4 w-4 mr-2"></i>
                    บันทึกการแก้ไข
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Modal ยืนยันการลบ -->
<div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden backdrop-blur-sm transition-all duration-300 opacity-0">
    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full transform scale-95 transition-all duration-300 border-t-4 border-red-500">
        <div class="text-center mb-6">
            <div class="bg-red-100 h-24 w-24 rounded-full flex items-center justify-center mx-auto mb-5 transform transition-transform hover:scale-105">
                <i data-feather="trash-2" class="h-12 w-12 text-red-500"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">ยืนยันการลบข้อมูล</h3>
            <p class="text-gray-600 mt-2 mb-3">คุณต้องการลบข้อมูลไก่ชื่อ <span class="font-bold text-red-600">{{ chicken.name }}</span> ใช่หรือไม่?</p>
            <div class="flex items-center justify-center gap-2 text-amber-600 bg-amber-50 p-3 rounded-lg mb-2">
                <i data-feather="alert-triangle" class="h-5 w-5"></i>
                <p class="text-sm">การกระทำนี้ไม่สามารถยกเลิกได้</p>
            </div>
        </div>
        <div class="flex justify-center gap-4">
            <button id="cancel-delete" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all duration-200 font-medium flex-1 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-300">
                ยกเลิก
            </button>
            <button id="confirm-delete" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all duration-200 font-medium flex-1 hover:shadow-md flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-red-500">
                <i data-feather="trash-2" class="h-4 w-4 mr-2"></i>
                ยืนยันการลบ
            </button>
        </div>
    </div>
</div>

<script>
    // เพิ่ม custom dropdown styling
    document.addEventListener('DOMContentLoaded', function() {
        const selects = document.querySelectorAll('select');
        
        selects.forEach(select => {
            const wrapper = document.createElement('div');
            wrapper.className = 'relative';
            
            const icon = document.createElement('div');
            icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>';
            icon.className = 'pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3';
            
            select.parentNode.insertBefore(wrapper, select);
            wrapper.appendChild(select);
            wrapper.appendChild(icon);
        });
        
        // ระบบยืนยันการลบ
        const deleteForm = document.getElementById('delete-form');
        const modal = document.getElementById('delete-confirm-modal');
        const modalContent = modal.querySelector('div');
        const cancelBtn = document.getElementById('cancel-delete');
        const confirmBtn = document.getElementById('confirm-delete');
        
        // ฟังก์ชันแสดง modal
        window.confirmDelete = function() {
            modal.classList.remove('hidden');
            // เพิ่ม timeout เพื่อให้ animation ทำงานหลังจากแสดงองค์ประกอบ
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
            return false; // ป้องกันการ submit ฟอร์ม
        };
        
        // ฟังก์ชันซ่อน modal พร้อม animation
        const hideModal = function() {
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); // ต้องตรงกับ duration ใน CSS
        };
        
        // ปุ่มยกเลิกการลบ
        cancelBtn.addEventListener('click', hideModal);
        
        // ปุ่มยืนยันการลบ
        confirmBtn.addEventListener('click', function() {
            // แสดง effect การกดปุ่ม
            this.classList.add('scale-95');
            setTimeout(() => {
                deleteForm.submit(); // ส่งฟอร์มเมื่อยืนยัน
            }, 150);
        });
        
        // ปิด modal เมื่อคลิกพื้นหลัง
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                hideModal();
            }
        });
        
        // เพิ่ม animation เมื่อกดปุ่ม
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
            button.addEventListener('mousedown', function() {
                this.classList.add('scale-95');
            });
            button.addEventListener('mouseup', function() {
                this.classList.remove('scale-95');
            });
            button.addEventListener('mouseleave', function() {
                this.classList.remove('scale-95');
            });
        });
    });
</script>
{% endblock %} 